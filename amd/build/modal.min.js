define(['jquery', 'core/modal_factory', 'core/templates', 'core/ajax'], function($, ModalFactory, Templates, Ajax) {
    return {
        init: function() {
            $('#open-history').on('click', function(e) {
                e.preventDefault(); // Предотвращаем действие по умолчанию

                // Отправляем AJAX-запрос для получения истории
                Ajax.call([{
                    methodname: 'block_quadratic_calculator_get_history',
                    args: {},
                    done: function(response) {
                        // Загружаем содержимое шаблона history.mustache с историей
                        Templates.render('block_quadratic_calculator/history', {history: response})
                        
                        .then(function(html, js) {
                            // Создаем и отображаем модальное окно с загруженным содержимым
                            //console.log(response, html, js);
                            return ModalFactory.create({
                                type: ModalFactory.types.ALERT,
                                title: 'История расчетов',
                                body: html
                            });
                        })
                        .then(function(modal) {
                            modal.show();
                            // Запускаем дополнительный JavaScript, если он есть
                            Templates.runTemplateJS(js);
                        });
                    },
                    fail: function(reason) {
                        // Обработка ошибки
                        console.error(reason);
                    }
                }]);
            });
        }
    };
});