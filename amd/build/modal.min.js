define(['jquery', 'core/modal_factory', 'core/templates', 'core/ajax', 'core/str'], function($, ModalFactory, Templates, Ajax, Str) {
    return {
        init: function() {
            $('#open-history').on('click', function(e) {
                e.preventDefault(); // Предотвращаем действие по умолчанию

                // Получаем локализованную строку для заголовка модального окна
                Str.get_string('calculation_history', 'block_quadratic_calculator').done(function(titleStr) {
                    
                    // Отправляем AJAX-запрос для получения истории
                    Ajax.call([{
                        methodname: 'block_quadratic_calculator_get_history',
                        args: {},
                        done: function(response) {
                            response.forEach(function(record) {
                                var date = new Date(record.timemodified * 1000);
                                record.timemodified = date.toLocaleString()
                            });
                            // Загружаем содержимое шаблона history.mustache с историей
                            Templates.render('block_quadratic_calculator/history', {history: response})
                            .then(function(html, js) {
                                // Создаем и отображаем модальное окно с загруженным содержимым
                                return ModalFactory.create({
                                    type: ModalFactory.types.ALERT,
                                    title: titleStr,
                                    body: html
                                })
                            })
                            .then(function(modal) {
                                modal.show();
                                // Запускаем дополнительный JavaScript, если он есть
                                Templates.runTemplateJS(js)
                            })
                        },
                        fail: function(reason) {
                            console.error(reason)
                        }
                    }])
                })
            })
        }
    }
})