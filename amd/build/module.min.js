define(['jquery', 'core/str'], function($, Str) {
    
    function updateResults(data, a, b, c) {
        var resultDiv = $('#result');
        // Очищаем предыдущие результаты
        resultDiv.empty();

        // Проверяем, есть ли в ответе данные для x1 и x2
        if (data.x1 !== undefined && data.x2 !== undefined) {
            // Формируем строку с уравнением и решением
            Str.get_strings([
                {key: 'received_equation', component: 'block_quadratic_calculator'},
                {key: 'solution', component: 'block_quadratic_calculator'}
            ]).done(function(strings) {
                var equation = strings[0] + ':<br>' + a + 'x<sup>2</sup> + ' + b + 'x + ' + c + ' = 0';
                var solution = strings[1] + ': x<sub>1</sub> = ' + data.x1 + ', x<sub>2</sub> = ' + data.x2;
            
                // Добавляем строки в div с результатами
                resultDiv.append(equation).append('<br>').append(solution);
            });

        } else if (data.error !== undefined) {
            // Если сервер вернул ошибку, отображаем её
            resultDiv.append(data.error);
        }
        // Меняем стиль на "block", чтобы показать результаты
        resultDiv.css('display', 'block');
    }

    return {
        init: function(selector) {
            $(selector).on('submit', function(e) {
                e.preventDefault(); // Предотвращаем стандартную отправку формы
                var form = $(this);
                var a = form.find('input[name="a"]').val();
                var b = form.find('input[name="b"]').val();
                var c = form.find('input[name="c"]').val();

                // Отправляем данные на сервер с помощью AJAX
                $.ajax({
                    type: 'POST',
                    url: form.attr('action'),
                    data: form.serialize(), // Сериализуем данные формы
                    dataType: 'json', // Ожидаем ответ в формате JSON
                    success: function(response) {
                        // Обрабатываем успешный ответ сервера
                        updateResults(response, a, b, c);
                    },
                    error: function(xhr, status, error) {
                        // Обрабатываем возможные ошибки запроса
                        console.error('AJAX Error: ' + status + ' - ' + error);
                    }
                });
            });
        }
    };
});